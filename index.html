<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario World - Escala Corrigida</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Arial Black', sans-serif; }
        
        #game-viewport { width: 800px; height: 450px; position: relative; overflow: hidden; border: 4px solid #fff; background: #5c94fc; }
        #world { position: absolute; width: 5000px; height: 100%; }

        /* CHÃO */
        .floor { 
            position: absolute; bottom: 0; width: 100%; height: 60px; 
            background: #70ad10; border-top: 5px solid #000;
        }

        /* MARIO - AJUSTE DE TAMANHO */
        #mario { 
            position: absolute; 
            width: 120px; /* Aumentei para 120px */
            height: 120px; 
            z-index: 10; 
            image-rendering: pixelated; 
            mix-blend-mode: multiply;
            /* Garante que a imagem caiba no quadrado sem esticar */
            object-fit: contain; 
        }

        /* BLOCO E MOEDA */
        .block {
            position: absolute; width: 45px; height: 45px;
            background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSYURGn9L0vIHRXz3SEUw2oGSQGw_euzItjLQ&s');
            background-size: cover;
            transition: transform 0.1s;
        }

        .coin {
            position: absolute; width: 30px; height: 30px;
            background: #ffd700; border-radius: 50%; border: 3px solid #f1c40f;
            animation: coinPop 0.5s forwards;
        }

        @keyframes coinPop {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-120px); opacity: 0; }
        }

        /* BANDEIRA FINAL */
        .goal-post {
            position: absolute; left: 4600px; bottom: 60px;
            width: 80px; height: 280px; border-left: 8px solid #fff; border-right: 8px solid #fff;
        }
        .goal-bar {
            position: absolute; width: 100%; height: 12px; background: #fff;
            bottom: 50px; animation: moveBar 3s infinite alternate ease-in-out;
        }
        @keyframes moveBar { from { bottom: 20px; } to { bottom: 250px; } }

        .overlay { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100; text-align: center; color: white; }
        .btn-ui { padding: 15px 30px; font-size: 20px; background: #e74c3c; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <div id="game-viewport">
        <div id="win-screen" class="overlay">
            <h1 style="color: yellow; font-size: 60px; text-shadow: 4px 4px #000;">COURSE CLEAR!</h1>
            <button class="btn-ui" onclick="location.reload()">JOGAR DE NOVO</button>
        </div>
        
        <div id="world">
            <div class="floor"></div>
            
            <div class="goal-post"><div class="goal-bar"></div></div>

            <div class="block" style="left: 500px; bottom: 220px;"></div>
            <div class="block" style="left: 545px; bottom: 220px;"></div>
            <div class="block" style="left: 900px; bottom: 260px;"></div>

            <img id="mario" src="parado_dir.png">
        </div>
    </div>

    <script>
        const mario = document.getElementById('mario');
        const world = document.getElementById('world');
        const blocks = document.querySelectorAll('.block');

        const sprites = {
            paradoDir: "./parado_dir.png", paradoEsq: "./parado_esq.png",
            andarDir: "./andar_dir_passo.png", andarEsq: "./andar_esq_passo.png",
            puloDir: "./pulo_dir.png", puloEsq: "./pulo_esq.png",
            agachoDir: "./agacho_dir.png", agachoEsq: "./agacho_esq.png",
            olharCima: "./olhar_cima.png"
        };

        let posX = 100, posY = 60, velY = 0, velX = 0;
        let isJump = false, ultimaDir = 'direita', jogoAtivo = true, frameAnim = 0;
        const keys = {};

        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        function criarMoeda(x, y) {
            const coin = document.createElement('div');
            coin.className = 'coin';
            coin.style.left = (x + 8) + 'px';
            coin.style.bottom = (y + 40) + 'px';
            world.appendChild(coin);
            setTimeout(() => coin.remove(), 500);
        }

        function update() {
            if (!jogoAtivo) return;

            let agachado = (keys['KeyS'] || keys['ArrowDown']) && !isJump;
            let olhandoCima = (keys['KeyW'] || keys['ArrowUp']) && !isJump && !keys['KeyA'] && !keys['KeyD'];
            let movendo = false;

            if (!agachado && !olhandoCima) {
                if (keys['KeyD'] || keys['ArrowRight']) { velX = 7; ultimaDir = 'direita'; movendo = true; }
                else if (keys['KeyA'] || keys['ArrowLeft']) { velX = -7; ultimaDir = 'esquerda'; movendo = true; }
                else { velX = 0; }
            } else { velX = 0; }

            if (keys['Space'] && !isJump && !agachado) { velY = -16; isJump = true; }

            velY += 0.8; posY -= velY; posX += velX;
            if (posY <= 60) { posY = 60; velY = 0; isJump = false; }
            if (posX < 0) posX = 0;

            // Colisão Cabeça (ajustada para o novo tamanho)
            blocks.forEach(b => {
                let bl = parseInt(b.style.left);
                let bb = parseInt(b.style.bottom);
                // Mario tem 120px, a cabeça está por volta de 100px de altura
                if (velY < 0 && (posY + 105) >= bb && (posY + 105) <= bb + 15 && (posX + 80) > bl && (posX + 40) < bl + 45) {
                    velY = 2;
                    b.style.transform = "translateY(-10px)";
                    setTimeout(() => b.style.transform = "translateY(0)", 50);
                    criarMoeda(bl, bb);
                }
            });

            if (posX >= 4600) { jogoAtivo = false; document.getElementById('win-screen').style.display = "block"; }

            mario.style.left = posX + 'px';
            mario.style.bottom = posY + 'px';
            world.style.transform = `translateX(${-Math.max(0, posX - 350)}px)`;

            // Troca de Sprite
            let img;
            if (isJump) img = (ultimaDir === 'direita' ? sprites.puloDir : sprites.puloEsq);
            else if (agachado) img = (ultimaDir === 'direita' ? sprites.agachoDir : sprites.agachoEsq);
            else if (olhandoCima) img = sprites.olharCima;
            else if (movendo) {
                frameAnim++;
                img = (frameAnim % 20 < 10) ? (ultimaDir === 'direita' ? sprites.paradoDir : sprites.paradoEsq) : (ultimaDir === 'direita' ? sprites.andarDir : sprites.andarEsq);
            } else img = (ultimaDir === 'direita' ? sprites.paradoDir : sprites.paradoEsq);

            if (!mario.src.endsWith(img.replace('./',''))) mario.src = img;

            requestAnimationFrame(update);
        }
        update();
    </script>
</body>
</html>
