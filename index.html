<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario World - Versão Final</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background-color: #222; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        #game-viewport { 
            width: 800px; 
            height: 400px; 
            position: relative; 
            overflow: hidden; 
            border: 4px solid #fff; 
            background: linear-gradient(#63c4eb, #ade1f5); /* Céu com degradê */
        }

        #world { 
            position: absolute; 
            width: 5000px; 
            height: 100%; 
        }

        .floor { 
            position: absolute; 
            bottom: 0; 
            width: 100%; 
            height: 50px; 
            background-color: #27ae60; 
            border-top: 5px solid #1e8449; 
        }

        #mario { 
            position: absolute; 
            /* Tamanho aumentado para 100px */
            width: 100px; 
            height: 100px; 
            z-index: 10; 
            image-rendering: pixelated; /* Mantém o estilo retro */
            /* Remove fundo branco (se a imagem tiver fundo branco puro) */
            mix-blend-mode: multiply; 
        }

        .instrucoes {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 5px;
            border-radius: 5px;
            font-size: 12px;
        }
    </style>
</head>
<body>

    <div id="game-viewport">
        <div class="instrucoes">Setas/WASD para mover e agachar | Espaço para Pular</div>
        <div id="world">
            <div class="floor"></div>
            <img id="mario" src="parado_dir.png">
        </div>
    </div>

    <script>
        const mario = document.getElementById('mario');
        const world = document.getElementById('world');

        // Configuração das imagens (Caminhos relativos para GitHub/Spck)
        const sprites = {
            paradoDir: "./parado_dir.png",
            paradoEsq: "./parado_esq.png",
            andarDir: "./andar_dir_passo.png", 
            andarEsq: "./andar_esq_passo.png",
            puloDir: "./pulo_dir.png", 
            puloEsq: "./pulo_esq.png",
            agachoDir: "./agacho_dir.png",
            agachoEsq: "./agacho_esq.png"
        };

        // Variáveis de controle
        let posX = 100, posY = 50;
        let velY = 0, velX = 0;
        let isJump = false;
        let ultimaDirecao = 'direita';
        let estaAndando = false;
        let frameAnimacao = 0;
        const keys = {};

        // Detectar teclas
        window.addEventListener('keydown', (e) => keys[e.code] = true);
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        function update() {
            // Lógica de agachamento (S ou Seta Baixo)
            let isCrouching = (keys['KeyS'] || keys['ArrowDown']) && !isJump;
            estaAndando = false;

            // Movimento Horizontal
            if (!isCrouching) {
                if (keys['KeyD'] || keys['ArrowRight']) { 
                    velX = 6; 
                    ultimaDirecao = 'direita';
                    estaAndando = true;
                } else if (keys['KeyA'] || keys['ArrowLeft']) { 
                    velX = -6; 
                    ultimaDirecao = 'esquerda';
                    estaAndando = true;
                } else { 
                    velX = 0; 
                }
            } else {
                velX = 0;
            }

            // --- SELEÇÃO DE IMAGEM (ANIMAÇÃO) ---
            let imgFinal;

            if (isJump) {
                imgFinal = (ultimaDirecao === 'direita') ? sprites.puloDir : sprites.puloEsq;
            } else if (isCrouching) {
                imgFinal = (ultimaDirecao === 'direita') ? sprites.agachoDir : sprites.agachoEsq;
            } else if (estaAndando) {
                // Alterna entre parado e passo a cada 10 quadros
                frameAnimacao++;
                if (frameAnimacao % 20 < 10) {
                    imgFinal = (ultimaDirecao === 'direita') ? sprites.paradoDir : sprites.paradoEsq;
                } else {
                    imgFinal = (ultimaDirecao === 'direita') ? sprites.andarDir : sprites.andarEsq;
                }
            } else {
                imgFinal = (ultimaDirecao === 'direita') ? sprites.paradoDir : sprites.paradoEsq;
                frameAnimacao = 0;
            }

            // Atualiza a imagem apenas se mudar para não travar
            if (!mario.src.endsWith(imgFinal.replace('./', ''))) {
                mario.src = imgFinal;
            }

            // Pulo (Espaço ou W ou Seta Cima)
            if ((keys['Space'] || keys['KeyW'] || keys['ArrowUp']) && !isJump && !isCrouching) { 
                velY = -15; 
                isJump = true; 
            }

            // Gravidade e Física
            velY += 0.8;
            posY -= velY;
            posX += velX;

            // Chão (Limite inferior)
            if (posY <= 50) { 
                posY = 50; 
                velY = 0; 
                isJump = false; 
            }

            // Limite de tela (Câmera simples seguindo o personagem)
            if (posX > 400) {
                world.style.transform = `translateX(${- (posX - 400)}px)`;
            }

            // Aplica as posições no CSS
            mario.style.left = posX + 'px';
            mario.style.bottom = posY + 'px';

            requestAnimationFrame(update);
        }

        // Iniciar o jogo
        update();
    </script>
</body>
</html>
