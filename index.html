<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Mario World - Versão Completa</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #222; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
        #game-viewport { width: 800px; height: 450px; position: relative; overflow: hidden; border: 4px solid #fff; background: #63c4eb; }
        #world { position: absolute; width: 5000px; height: 100%; }
        .floor { position: absolute; bottom: 0; width: 100%; height: 60px; background-color: #27ae60; border-top: 6px solid #1e8449; }
        #mario { position: absolute; width: 100px; height: 100px; z-index: 10; image-rendering: pixelated; mix-blend-mode: multiply; }
        
        /* Telas de Game Over e Vitória */
        .overlay { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 100; }
        .overlay h1 { color: white; font-size: 50px; text-shadow: 3px 3px #000; margin-bottom: 20px; }
        button { padding: 10px 20px; font-size: 20px; cursor: pointer; background: #e74c3c; color: white; border: none; }
    </style>
</head>
<body>

    <div id="game-viewport">
        <div id="death-screen" class="overlay">
            <h1>GAME OVER</h1>
            <button onclick="resetJogo()">TENTAR DE NOVO</button>
        </div>

        <div id="world">
            <div class="floor"></div>
            <img id="mario" src="parado_dir.png">
        </div>
    </div>

    <script>
        const mario = document.getElementById('mario');
        const deathScreen = document.getElementById('death-screen');

        const sprites = {
            paradoDir: "./parado_dir.png",
            paradoEsq: "./parado_esq.png",
            andarDir: "./andar_dir_passo.png",
            andarEsq: "./andar_esq_passo.png",
            puloDir: "./pulo_dir.png",
            puloEsq: "./pulo_esq.png",
            agachoDir: "./agacho_dir.png",
            agachoEsq: "./agacho_esq.png",
            olharCima: "./olhar_cima.png", // NOVO
            morto: "./morto.png"            // NOVO
        };

        let posX, posY, velY, velX, isJump, ultimaDirecao, estaAndando, jogoAtivo, morrendo;
        const keys = {};

        function resetJogo() {
            posX = 100; posY = 60; velY = 0; velX = 0;
            isJump = false; ultimaDirecao = 'direita';
            jogoAtivo = true; morrendo = false;
            deathScreen.style.display = "none";
            mario.style.opacity = "1";
        }

        window.addEventListener('keydown', (e) => keys[e.code] = true);
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        // Função para simular a morte (você pode chamar isso se cair num buraco ou tocar num inimigo)
        function morrer() {
            if (!jogoAtivo || morrendo) return;
            jogoAtivo = false;
            morrendo = true;
            mario.src = sprites.morto;
            velY = -15; // Pulinho de morte
            
            setTimeout(() => {
                deathScreen.style.display = "block";
            }, 1500);
        }

        function update() {
            if (morrendo) {
                velY += 0.8;
                posY -= velY;
                mario.style.bottom = posY + 'px';
                requestAnimationFrame(update);
                return;
            }

            if (!jogoAtivo) return;

            let isCrouching = (keys['KeyS'] || keys['ArrowDown']) && !isJump;
            let isLookingUp = (keys['KeyW'] || keys['ArrowUp']) && !isJump && !keys['KeyA'] && !keys['KeyD'];
            estaAndando = false;

            if (!isCrouching && !isLookingUp) {
                if (keys['KeyD'] || keys['ArrowRight']) { velX = 7; ultimaDirecao = 'direita'; estaAndando = true; }
                else if (keys['KeyA'] || keys['ArrowLeft']) { velX = -7; ultimaDirecao = 'esquerda'; estaAndando = true; }
                else { velX = 0; }
            } else { velX = 0; }

            // Lógica de Imagem
            let imgFinal;
            if (isJump) {
                imgFinal = (ultimaDirecao === 'direita') ? sprites.puloDir : sprites.puloEsq;
            } else if (isCrouching) {
                imgFinal = (ultimaDirecao === 'direita') ? sprites.agachoDir : sprites.agachoEsq;
            } else if (isLookingUp) {
                imgFinal = sprites.olharCima; // Ação de olhar para cima
            } else if (estaAndando) {
                imgFinal = (Math.floor(Date.now() / 100) % 2 === 0) ? 
                    ((ultimaDirecao === 'direita') ? sprites.paradoDir : sprites.paradoEsq) : 
                    ((ultimaDirecao === 'direita') ? sprites.andarDir : sprites.andarEsq);
            } else {
                imgFinal = (ultimaDirecao === 'direita') ? sprites.paradoDir : sprites.paradoEsq;
            }

            if (!mario.src.endsWith(imgFinal.replace('./', ''))) mario.src = imgFinal;

            // Pulo (Só pula se não estiver olhando para cima)
            if (keys['Space'] && !isJump && !isCrouching) { velY = -16; isJump = true; }

            velY += 0.8; posY -= velY; posX += velX;
            if (posY <= 60) { posY = 60; velY = 0; isJump = false; }
            
            // Se cair do mapa (exemplo de morte)
            if (posY < -50) morrer();

            mario.style.left = posX + 'px';
            mario.style.bottom = posY + 'px';
            requestAnimationFrame(update);
        }

        resetJogo();
        update();
    </script>
</body>
</html>
