<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario World - Correção de Fundo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #222; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Arial Black', sans-serif; }
        
        /* O fundo azul precisa ser um pouco claro para o modo 'multiply' funcionar */
        #game-viewport { width: 800px; height: 450px; position: relative; overflow: hidden; border: 4px solid #fff; background: #5c94fc; }
        #world { position: absolute; width: 5000px; height: 100%; }
        .floor { position: absolute; bottom: 0; width: 100%; height: 60px; background: #70ad10; border-top: 5px solid #000; }

        /* MARIO - Aumentado e com filtro para remover fundo branco */
        #mario { 
            position: absolute; 
            width: 160px; 
            height: 160px; 
            z-index: 10; 
            image-rendering: pixelated; 
            /* O segredo está aqui: */
            mix-blend-mode: multiply; 
            filter: contrast(1.2); 
            object-fit: contain; 
        }

        /* CAIXA DE INTERROGAÇÃO (Feita em CSS para não ter fundo branco) */
        .block {
            position: absolute; width: 60px; height: 60px;
            background: #f39c12; border: 4px solid #000;
            display: flex; justify-content: center; align-items: center;
            font-size: 40px; color: #fff; font-weight: bold;
            z-index: 5; box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
        }
        .block::after { content: "?"; }

        .coin {
            position: absolute; width: 35px; height: 35px;
            background: #ffd700; border-radius: 50%; border: 3px solid #b8860b;
            z-index: 4; animation: coinPop 0.5s forwards;
        }

        @keyframes coinPop {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-140px); opacity: 0; }
        }

        .goal-post { position: absolute; left: 4600px; bottom: 60px; width: 100px; height: 320px; border-left: 10px solid #fff; border-right: 10px solid #fff; }
        .goal-bar { position: absolute; width: 100%; height: 15px; background: #fff; bottom: 50px; animation: moveBar 3s infinite alternate ease-in-out; }
        @keyframes moveBar { from { bottom: 20px; } to { bottom: 290px; } }

        .overlay { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100; text-align: center; color: white; }
        .btn-ui { padding: 15px 30px; font-size: 20px; background: #e74c3c; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <div id="game-viewport">
        <div id="win-screen" class="overlay">
            <h1 style="color: yellow; font-size: 60px; text-shadow: 4px 4px #000;">COURSE CLEAR!</h1>
            <button class="btn-ui" onclick="location.reload()">JOGAR DE NOVO</button>
        </div>
        
        <div id="world">
            <div class="floor"></div>
            <div class="goal-post"><div class="goal-bar"></div></div>

            <div class="block" style="left: 600px; bottom: 260px;"></div>
            <div class="block" style="left: 665px; bottom: 260px;"></div>

            <img id="mario" src="parado_dir.png">
        </div>
    </div>

    <script>
        const mario = document.getElementById('mario');
        const world = document.getElementById('world');
        const blocks = document.querySelectorAll('.block');

        const sprites = {
            paradoDir: "./parado_dir.png", paradoEsq: "./parado_esq.png",
            andarDir: "./andar_dir_passo.png", andarEsq: "./andar_esq_passo.png",
            puloDir: "./pulo_dir.png", puloEsq: "./pulo_esq.png",
            agachoDir: "./agacho_dir.png", agachoEsq: "./agacho_esq.png",
            olharCima: "./olhar_cima.png"
        };

        let posX = 100, posY = 60, velY = 0, velX = 0;
        let isJump = false, ultimaDir = 'direita', jogoAtivo = true, frameAnim = 0;
        const keys = {};

        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        function criarMoeda(x, y) {
            const coin = document.createElement('div');
            coin.className = 'coin';
            coin.style.left = (x + 12) + 'px';
            coin.style.bottom = (y + 50) + 'px';
            world.appendChild(coin);
            setTimeout(() => coin.remove(), 500);
        }

        function update() {
            if (!jogoAtivo) return;

            let agachado = (keys['KeyS'] || keys['ArrowDown']) && !isJump;
            let olhandoCima = (keys['KeyW'] || keys['ArrowUp']) && !isJump && !keys['KeyA'] && !keys['KeyD'];
            let movendo = false;

            if (!agachado && !olhandoCima) {
                if (keys['KeyD'] || keys['ArrowRight']) { velX = 8; ultimaDir = 'direita'; movendo = true; }
                else if (keys['KeyA'] || keys['ArrowLeft']) { velX = -8; ultimaDir = 'esquerda'; movendo = true; }
                else { velX = 0; }
            } else { velX = 0; }

            if (keys['Space'] && !isJump && !agachado) { velY = -18; isJump = true; }

            velY += 0.8; posY -= velY; posX += velX;
            if (posY <= 60) { posY = 60; velY = 0; isJump = false; }
            if (posX < 0) posX = 0;

            blocks.forEach(b => {
                let bl = parseInt(b.style.left);
                let bb = parseInt(b.style.bottom);
                if (velY < 0 && (posY + 145) >= bb && (posY + 145) <= bb + 20 && (posX + 110) > bl && (posX + 50) < bl + 60) {
                    velY = 3;
                    b.style.transform = "translateY(-15px)";
                    setTimeout(() => b.style.transform = "translateY(0)", 100);
                    criarMoeda(bl, bb);
                }
            });

            if (posX >= 4600) { jogoAtivo = false; document.getElementById('win-screen').style.display = "block"; }

            mario.style.left = posX + 'px';
            mario.style.bottom = posY + 'px';
            world.style.transform = `translateX(${-Math.max(0, posX - 320)}px)`;

            let img;
            if (isJump) img = (ultimaDir === 'direita' ? sprites.puloDir : sprites.puloEsq);
            else if (agachado) img = (ultimaDir === 'direita' ? sprites.agachoDir : sprites.agachoEsq);
            else if (olhandoCima) img = sprites.olharCima;
            else if (movendo) {
                frameAnim++;
                img = (frameAnim % 20 < 10) ? (ultimaDir === 'direita' ? sprites.paradoDir : sprites.paradoEsq) : (ultimaDir === 'direita' ? sprites.andarDir : sprites.andarEsq);
            } else img = (ultimaDir === 'direita' ? sprites.paradoDir : sprites.paradoEsq);

            if (!mario.src.endsWith(img.replace('./',''))) mario.src = img;

            requestAnimationFrame(update);
        }
        update();
    </script>
</body>
</html>
